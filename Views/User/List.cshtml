@model PagedList.IPagedList<AdminPanel.Models.PassangerSearchModel>
@using PagedList.Mvc

@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/Layout.cshtml";
}

<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css" rel='stylesheet' type='text/css'>
<link href="~/CSS/Table.css" rel="stylesheet" />

<section class="content-header">
    <h1>
        Passengers
        <small>List & Search</small>
    </h1>
    <ol class="breadcrumb">
        <li><a href="/Admin/Index"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Passengers</li>
    </ol>
</section>

<section class="content">
    <div class="form-horizontal">
        <div class="panel-group">
            <div class="panel panel-default panel-search">
                <div class="panel-body">
                    <h3 style="margin-top: 0px;margin-bottom: 0px;">
                        Search Panel
                    </h3>
                    <hr />
                    <div class="row" id="SearchElementDiv">

                        <div class="col-md-4 text-right">
                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchName" title="">Name</label><div class="ico-help" title="A product name."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <input class="form-control text-box single-line" id="SearchName" name="Name" type="text" value="">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchMobile" title="">Mobile</label><div class="ico-help" title="A product name."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <input class="form-control text-box single-line" id="SearchMobile" name="Mobile" type="text" value="">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchGender" title="">Gender</label><div class="ico-help" title="Search by a specific vendor."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-control" data-val="true" data-val-number="The field Vendor must be a number." id="SearchGender" name="Gender">
                                        <option selected="selected" value="">All</option>
                                        <option value="Male">Male</option>
                                        <option value="Female">Female</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4 text-right">
                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchCountry" title="">Country</label><div class="ico-help" title="Search by a specific store."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-control" data-val="true" data-val-number="The field Store must be a number." id="SearchCountry" name="Country">
                                        <option selected="selected" value="">Select</option>
                                        <option value="1">USA</option>
                                        <option value="0">India</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchState" title="">State</label><div class="ico-help" title="Search by a specific warehouse."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-control" data-val="true" data-val-number="The field Warehouse must be a number." id="SearchState" name="State">
                                        <option selected="selected" value="">All</option>
                                        <option value="Florida">Florida</option>
                                        <option value="Gujarat">Gujarat</option>
                                        <option value="Ny">Ny</option>
                                        <option value="CT">CT</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchCity" title="">City</label><div class="ico-help" title="Search by a product type."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-control" data-val="true" data-val-number="The field Product type must be a number." id="SearchCity" name="City">
                                        <option selected="selected" value="">All</option>
                                        <option value="Plantation">Plantation</option>
                                        <option value="Ahmedabad">Ahmedabad</option>
                                        <option value="East Hartford">East Hartford</option>
                                        <option value="Brooklyn">Brooklyn</option>
                                    </select>
                                </div>
                            </div>

                        </div>
                        <div class="col-md-4 text-right">
                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchEmail" title="">Email</label><div class="ico-help" title="A product name."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <input class="form-control text-box single-line" id="SearchEmail" name="Email" type="text" value="">
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="col-md-4">
                                    <div class="label-wrapper"><label class="control-label" for="SearchStatus" title="">Status</label><div class="ico-help" title="Search by a &quot;Published&quot; property."></div></div>
                                </div>
                                <div class="col-md-8">
                                    <select class="form-control" data-val="true" data-val-number="The field Published must be a number." id="SearchStatus" name="Status">
                                        <option selected="selected" value="">All</option>
                                        <option value="Active">Active</option>
                                        <option value="InActive">InActive</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="row">
                        <div class="col-md-7 col-md-offset-5">
                            <button type="button" id="search-passanger" name="search-passanger" class="btn btn-primary btn-search">
                                <i class="fa fa-search"></i>
                                Search
                            </button>
                            <button type="button" id="reset-search" onclick="location.href='@Url.Action("List", "User")'" name="reset-search" class="btn btn-primary btn-search">
                                <i class="fa fa-refresh">&nbsp;</i>
                                Reset &nbsp;
                            </button>
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col col-xs-6">
                            <div class="col col-xs-6">
                                <div class="input-group input-group-short">
                                    <select class="form-control text-box single-line " data-val="true" data-val-number="The field Category must be a number." id="SearchCategoryId" name="SearchCategoryId">
                                        <option selected="selected" value="0">--select--</option>
                                        <option value="1">Active</option>
                                        <option value="2">InActive</option>
                                    </select>
                                    <span class="input-group-btn">
                                        <button type="button" id="active-selected" class="btn btn-success btn-flat">Submit</button>
                                    </span>
                                </div>
                            </div>
                            <div>
                                <button type="button" id="delete-selected" class="btn bg-red">
                                    <i class="fa fa-trash-o"></i>
                                    Delete (selected)
                                </button>
                            </div>
                        </div>
                        <div class="col col-xs-6 text-right">

                        </div>
                    </div>
                </div>
            </div>
            <div class="panel panel-default panel-table">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col col-xs-6">
                            <h3 class="panel-title"> Passengers </h3>
                        </div>
                        <div class="col col-xs-6 text-right">
                            <div id="divStatusCheckbox">
                                <label>Filter : &nbsp;&nbsp;</label>
                                <label class="checkbox-inline"><input type="checkbox" name="Status" id="StatusAll" value="All" /> All</label>
                                <label class="checkbox-inline"><input type="checkbox" name="Status" id="Active" value="Active" /> Active</label>
                                <label class="checkbox-inline"><input type="checkbox" name="Status" id="InActive" value="InActive" /> InActive</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-bordered table-list">
                        <thead>
                            <tr>
                                <th style="width:auto">
                                    <label class="checkbox-inline">
                                        <input type="checkbox" id="tblCheckbox" name="tblCheckbox" action="" />
                                    </label>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Status" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Status" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Status&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Status</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Name" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Name" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Name&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Name</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Email" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Email" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Email&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Email</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Mobile" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Mobile" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Mobile&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Mobile</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Gender" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Gender" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Gender&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Gender</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Country" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "Country" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=Country&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">Country</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "State" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "State" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=State&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">State</a>
                                </th>
                                <th style="width:auto" class="@(Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "City" && Request.QueryString["orderDir"] == "asc") ? "sorting_asc" :
                                            (Request.QueryString["orderBy"] != null && (Request.QueryString["orderBy"] == "City" && Request.QueryString["orderDir"] == "desc") ? "sorting_desc" : "sorting"))">
                                    <a href="?orderBy=City&orderDir=@(Request.QueryString["orderDir"] == null ? "desc" : (Request.QueryString["orderDir"] == "asc" ? "desc" : "asc"))">City</a>
                                </th>
                                @*<th>
                                    <a>Rides</a>
                                </th>*@
                                <th style="width:auto"><a href="">Action</a></th>
                            </tr>
                        </thead>
                        <tbody>
                            @if (Model.Any())
                            {
                                foreach (var item in Model)
                                {
                                    <tr>
                                        <td>
                                            <input type="checkbox" id="@item.UserId" name="@item.UserId" />
                                        </td>
                                        <td>@(item.IsActive == true ? "Active" : "InActive")  </td>
                                        <td>
                                            <a onclick="location.href='@Url.Action("Details", "User", new { userId = item.UserId })'">
                                                @item.Name
                                            </a>
                                        </td>
                                        <td>@item.Email</td>
                                        <td>@item.Mobile</td>
                                        <td>@item.Gender</td>
                                        <td>@item.CountryId</td>
                                        <td>@item.State</td>
                                        <td>@item.City</td>
                                        @*<td>@item.Rides</td>*@

                                        <td>
                                            <a onclick="location.href='@Url.Action("Details", "User", new { userId = item.UserId })'" class="btn btn-primary btn-xs" data-placement="top" data-toggle="tooltip" title="Details"><span class="glyphicon glyphicon-info-sign"></span></a>
                                            <a id="@item.UserId" class="btn btn-danger btn-xs" data-placement="top" data-toggle="tooltip" title="Delete"><span class="glyphicon glyphicon-trash"></span></a>
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td colspan="10">
                                        No Record Found
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col col-xs-4">
                            Page @(Model.PageCount < Model.PageNumber ? 0 : Model.PageNumber) of @Model.PageCount
                        </div>
                        <div class="col col-xs-8">
                            @Html.PagedListPager(Model, page => Url.Action("List",
        new { page, sortOrder = ViewBag.CurrentSort, filterLastName = ViewBag.filterLastName, filterMidName = ViewBag.filterMidName, filterDate = ViewBag.filterDate }))
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script>

    //document ready drag pagelist item to right
    $(document).ready(function () {
        $(".pagination-container").addClass("pull-right");

        //get parameter from querystring
        function GetParameterValues(param) {
            var url = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
            for (var i = 0; i < url.length; i++) {
                var urlparam = url[i].split('=');
                if (urlparam[0] == param) {
                    return urlparam[1];
                }
            }
        }

        var status = GetParameterValues('Status');
        if (status == 'All') {
            $("#divStatusCheckbox input:checkbox[id='StatusAll']").prop("checked", true);
        } else if (status == 'Active') {
            $("#divStatusCheckbox input:checkbox[id='Active']").prop("checked", true);
        } else if (status == 'InActive') {
            $("#divStatusCheckbox input:checkbox[id='InActive']").prop("checked", true);
        } else if (status === undefined) {
            $("#divStatusCheckbox input:checkbox[id='StatusAll']").prop("checked", true);
        }
    });

    //check-uncheck checkbox on click #tblCheckbox
    $('#tblCheckbox').click(function () {
        var checked_status = this.checked;
        $(this).closest('table').find('input:checkbox').each(function () {
            this.checked = checked_status;
        });
    });

    //paging with searching

    $('ul.pagination li a').click(function (e) {
        var href = $(this).attr('href');

        if (href === undefined || $.trim(href) === '') {
            e.preventDefault();
        } else {
            var query = window.location.href.split('?');

            if (query.length > 1) {
                var data = query[1];
                if (data.substring(0, 4) == 'page') {
                    if (data.split('&').length > 1) {
                        data = data.substring(data.indexOf('&'));
                        href += data;
                        $(this).attr('href', href);
                    }
                } else {
                    href += '&' + data;
                    $(this).attr('href', href);
                }
            }
        }
    });

    //sorting with searching
    $('table th a').click(function () {
        var href = $(this).attr('href');

        var query = window.location.href.split('?');

        if (query.length > 1) {

            var data = query[1];
            data = data.replace('&orderDir=desc', ''); data = data.replace('orderDir=desc', '');
            data = data.replace('&orderDir=asc', ''); data = data.replace('orderDir=asc', '');
            data = data.replace('&orderBy=Status', ''); data = data.replace('orderBy=Status', '');
            data = data.replace('&orderBy=Name', ''); data = data.replace('orderBy=Name', '');
            data = data.replace('&orderBy=Email', ''); data = data.replace('orderBy=Email', '');
            data = data.replace('&orderBy=Mobile', ''); data = data.replace('orderBy=Mobile', '');
            data = data.replace('&orderBy=Gender', ''); data = data.replace('orderBy=Gender', '');
            data = data.replace('&orderBy=Country', ''); data = data.replace('orderBy=Country', '');
            data = data.replace('&orderBy=State', ''); data = data.replace('orderBy=State', '');
            data = data.replace('&orderBy=City', ''); data = data.replace('orderBy=City', '');

            if (data != "") {
                //if (data.charAt(0)=='&') {
                data = '?' + data;
                data += '&' + href.substring(1, href.length);
                $(this).attr('href', data);
                //}
            }
        }
    });

    //status with searching
    $('#divStatusCheckbox input:checkbox').on('change', function () {
        $('#divStatusCheckbox input').not(this).prop('checked', false);
        var query = (window.location.href).split('?');
        if (query.length > 1) {
            var data = query[1];
            if (data.substring(0, 4) == 'page') {
                if (data.indexOf('&') > -1) {
                    data = data.substring(data.indexOf('&'));
                    data = data.replace('&Status=All', '');
                    data = data.replace('&Status=Active', '');
                    data = data.replace('&Status=InActive', '');

                    data = data.replace('Status=All', '');
                    data = data.replace('Status=Active', '');
                    data = data.replace('Status=InActive', '');
                    var result = "";
                    if (data == "") {
                        result = '?page=1&Status=' + $('#divStatusCheckbox input:checked').val();
                        result = result.replace('&Status=undefined', '');
                    } else {
                        result = '?page=1' + data + '&Status=' + $('#divStatusCheckbox input:checked').val();
                        result = result.replace('&Status=undefined', '');
                    }
                    window.location.replace(result);
                } else {
                    data = "";
                    data += '?page=1&Status=' + $('#divStatusCheckbox input:checked').val();
                    data = data.replace('&Status=undefined', '');
                    window.location.replace(data);
                }
            } else {
                query = "";
                query += '?page=1&' + data + 'Status=' + $('#divStatusCheckbox input:checked').val();
                query = query.replace('&Status=undefined', '');
                window.location.replace(query);
            }
        }
        else {
            query = "";
            query += '?page=1&Status=' + $('#divStatusCheckbox input:checked').val();
            query = query.replace('&Status=undefined', '');
            window.location.replace(query);
        }
    });

    //on click search buttton bind query string
    $('#search-passanger').click(function myfunction() {
        var query_string = "";

        query_string += "?page=1";

        $('#SearchElementDiv').find('*:input,select').each(function () {
            if ($(this).val().length > 0) {
                query_string += "&" + $(this).attr('name') + "=" + $(this).val();
            }
        });
        window.location.replace(query_string);
    });

    //delete selected passanger
    $("#delete-selected").click(function (event) {

        if (confirm("Are you sure?")) {
            event.preventDefault();

            var queryUrl = window.location.href;
            var checkedIDs = [];

            $("table tbody tr td input:checkbox:checked").map(function () {
                checkedIDs.push($(this).attr('id'));
                console.log(checkedIDs);
            });

            if (checkedIDs <= 0) {
                alert('Please check at least one Passenger to Delete.');
                return false;
            }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("DeleteSelected","User")',
                dataType: "json",
                data: { checkedIDs: checkedIDs },
                success: function (result) {
                    window.location.replace(queryUrl);
                    alert(result);
                },
                error: function (result) {
                    alert("error");
                }
            });
        }
    });

    //active/inactive selected passanger
    $("#active-selected").click(function (event) {

        if (confirm("Are you sure?")) {
            event.preventDefault();

            var queryUrl = window.location.href;
            var checkedIDs = [];

            var actionId = $("#SearchCategoryId").find(":selected").val();
            if (actionId <= 0) {
                alert('Please select status you want to change.');
                return false;
            }
            
            $("table tbody tr td input:checkbox:checked").map(function () {
                checkedIDs.push($(this).attr('id'));
                console.log(checkedIDs);
            });
            
            if (checkedIDs <= 0) {
                alert('Please check at least one Passenger to Activate or Deactivate.');
                return false;
            }

            $.ajax({
                type: 'POST',
                url: '@Url.Action("ActiveSelected", "User")',
                dataType: "json",
                data: { checkedIDs: checkedIDs, action: actionId },
                success: function (result) {
                    window.location.replace(queryUrl);
                    alert(result);
                },
                error: function (result) {
                    alert("error");
                }
            });
        }
    });

    //Delete single user
    $(".btn.btn-danger.btn-xs").click(function (event) {

        if (confirm("Are you sure?")) {
            event.preventDefault();

            var queryUrl = window.location.href;
            var clickedID = $(this).attr('id');

            $.ajax({
                type: 'POST',
                url: '@Url.Action("Delete", "User")',
                dataType: "json",
                data: { userId: clickedID },
                success: function (result) {
                    window.location.replace(queryUrl);
                    alert(result);
                },
                error: function (result) {
                    alert("error");
                }
            });
        }
    });

</script>
